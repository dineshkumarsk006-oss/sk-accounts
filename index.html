<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventory Entry — S.K. Accounts</title>
    <meta name="description" content="Record material sales, track quantities and client balances.">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/lucide@0.344.0/dist/umd/lucide.min.js"></script>
</head>

<body>

    <!-- Mobile sidebar overlay -->
    <div class="sb-overlay" id="sbOverlay"></div>

    <!-- Toast container -->
    <div class="toast-stack" id="toastStack"></div>

    <div class="app-shell">

        <!-- ══════════ SIDEBAR ══════════ -->
        <aside class="sidebar" id="sidebar">
            <div class="sb-brand">
                <div class="sb-logo">SK</div>
                <span class="sb-name">S.K. Accounts</span>
            </div>
            <div class="sb-nav">
                <div class="sb-section-label">Workspace</div>
                <nav>
                    <a href="index.html" class="active">
                        <i data-lucide="package"></i>
                        Inventory Entry
                    </a>
                    <a href="sales_inventory.html">
                        <i data-lucide="truck"></i>
                        Driver Details
                    </a>
                </nav>
            </div>
            <div class="sb-footer">
                <p class="sb-footer-text">S.K. Accounts · v2.0</p>
            </div>
        </aside>

        <!-- ══════════ MAIN AREA ══════════ -->
        <div class="main-area">

            <!-- Topbar -->
            <div class="topbar">
                <button class="mobile-menu-btn" id="mobileMenuBtn" aria-label="Open menu">
                    <i data-lucide="menu"></i>
                </button>
                <span class="topbar-crumb">S.K. Accounts</span>
                <span class="topbar-sep">/</span>
                <span class="topbar-page">Inventory Entry</span>
                <div class="topbar-gap"></div>
                <span class="topbar-date" id="topbarDate"></span>
            </div>

            <!-- Page content -->
            <div class="page-content">

                <!-- Header -->
                <div class="page-header">
                    <h1>Inventory Entry</h1>
                    <p>Record material sales, track client balances and quantities</p>
                </div>

                <!-- ── Stats ── -->
                <p class="section-label">Overview</p>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon-wrap sic-blue"><i data-lucide="layers"></i></div>
                        <div class="stat-body">
                            <div class="stat-lbl">Total Entries</div>
                            <div class="stat-val" id="statTotal">—</div>
                            <div class="stat-hint">All records</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon-wrap sic-green"><i data-lucide="trending-up"></i></div>
                        <div class="stat-body">
                            <div class="stat-lbl">Today's Sales</div>
                            <div class="stat-val" id="statToday">—</div>
                            <div class="stat-hint">Current day</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon-wrap sic-purple"><i data-lucide="calendar"></i></div>
                        <div class="stat-body">
                            <div class="stat-lbl">This Month</div>
                            <div class="stat-val" id="statMonth">—</div>
                            <div class="stat-hint">Month to date</div>
                        </div>
                    </div>
                </div>

                <!-- ── Entry Form ── -->
                <p class="section-label">New Entry</p>
                <div class="card">
                    <div class="card-header">
                        <div>
                            <div class="card-title">Add Inventory Record</div>
                            <div class="card-sub">Fill in the form to record a new material sale</div>
                        </div>
                        <span class="pill pill-blue">Sale</span>
                    </div>
                    <div class="card-body">
                        <form id="inventoryForm" novalidate>
                            <input type="hidden" id="type" name="type" value="sale">

                            <div class="form-grid">

                                <div class="form-group" id="grp-name">
                                    <label for="name">Client Name</label>
                                    <input type="text" id="name" name="name" list="nameList"
                                        placeholder="Select or type name" required autocomplete="off">
                                    <datalist id="nameList">
                                        <option value="Add New Client...">
                                        <option value="Default Client 1">
                                        <option value="Default Client 2">
                                        <option value="Default Client 3">
                                        <option value="Default Client 4">
                                    </datalist>
                                    <span class="field-error">Client name is required.</span>
                                </div>

                                <div class="form-group" id="grp-date">
                                    <label for="date">Date</label>
                                    <input type="date" id="date" name="date" required>
                                    <span class="field-error">Date is required.</span>
                                </div>

                                <div class="form-group" id="grp-material">
                                    <label for="material">Material</label>
                                    <select id="material" name="material" required>
                                        <option value="" disabled selected>Select material</option>
                                        <option value="M Sand">M Sand</option>
                                        <option value="P Sand">P Sand</option>
                                        <option value="Sand">Sand</option>
                                        <option value="Steel TMT">Steel TMT Bars</option>
                                        <option value="Aggregates">Aggregates / Gravel</option>
                                        <option value="Concrete Blocks">Concrete Blocks</option>
                                        <option value="Tiles">Tiles</option>
                                        <option value="Paint">Paint</option>
                                        <option value="Wood">Wood / Timber</option>
                                        <option value="Plumbing">Plumbing Pipes</option>
                                    </select>
                                    <span class="field-error">Please select a material.</span>
                                </div>

                                <div class="form-group" id="grp-quantity">
                                    <label for="quantity">Quantity (Units)</label>
                                    <input type="number" id="quantity" name="quantity" placeholder="0" min="0" required>
                                    <span class="field-error">Quantity is required.</span>
                                </div>

                                <div class="form-group" id="grp-price">
                                    <label for="price">Current Amount (₹)</label>
                                    <input type="number" id="price" name="price" placeholder="0.00" min="0" step="0.01"
                                        required>
                                    <span class="field-error">Amount is required.</span>
                                </div>

                                <div class="form-group">
                                    <label for="balance">Previous Balance (₹)</label>
                                    <input type="number" id="balance" name="balance" placeholder="0.00" step="0.01"
                                        value="0">
                                </div>

                                <div class="form-group span-2">
                                    <label for="total">Total Due (₹)</label>
                                    <input type="number" id="total" name="total" placeholder="Auto-calculated" readonly
                                        class="input-total">
                                </div>

                            </div>

                            <div class="form-footer">
                                <button type="button" class="btn-outline" id="btnClearForm">
                                    <i data-lucide="rotate-ccw"></i> Clear
                                </button>
                                <button type="submit" class="btn-primary" id="btnSaveEntry">
                                    <i data-lucide="check"></i> Save Entry
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- ── Reports & Data ── -->
                <p class="section-label">Reports &amp; Data</p>
                <div class="action-row">
                    <button id="btnWeeklyReport" class="btn-secondary">
                        <i data-lucide="bar-chart-2"></i> Weekly
                    </button>
                    <button id="btnMonthlyReport" class="btn-secondary">
                        <i data-lucide="calendar-days"></i> Monthly
                    </button>
                    <button id="btnViewData" class="btn-blue-ghost">
                        <i data-lucide="table-2"></i> View Data
                    </button>
                    <div class="spacer"></div>
                    <button id="btnResetEntries" class="btn-danger">
                        <i data-lucide="trash-2"></i> Reset
                    </button>
                </div>

                <!-- Reports panel -->
                <div id="reportsSection" class="panel hidden">
                    <div class="panel-header">
                        <span class="panel-title" id="reportTitle">Report</span>
                        <button id="closeReport" class="close-btn"><i data-lucide="x"></i></button>
                    </div>
                    <div class="panel-body">
                        <div class="chart-container">
                            <canvas id="reportChart"></canvas>
                        </div>
                    </div>
                    <div id="reportSummary" class="report-summary"></div>
                </div>

                <!-- Data table panel -->
                <div id="dataSection" class="panel hidden">
                    <div class="panel-header">
                        <span class="panel-title" id="dataTableTitle">Recent Entries</span>
                        <div style="display:flex;align-items:center;gap:8px;flex-shrink:0;">
                            <span class="entries-info" id="entriesCountBadge"></span>
                            <button id="closeData" class="close-btn"><i data-lucide="x"></i></button>
                        </div>
                    </div>
                    <div class="table-wrap">
                        <table id="dataTable">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Client</th>
                                    <th>Material</th>
                                    <th>Qty</th>
                                    <th>Amount (₹)</th>
                                    <th>Total (₹)</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>

            </div><!-- /page-content -->
        </div><!-- /main-area -->
    </div><!-- /app-shell -->

    <!-- ── Add New Client Modal ── -->
    <div id="newClientModal" class="modal hidden">
        <div class="modal-box">
            <div class="modal-box-hd">
                <h3>Add New Client</h3>
            </div>
            <div class="modal-box-bd">
                <div class="form-group">
                    <label for="newClientName">Client Name</label>
                    <input type="text" id="newClientName" placeholder="Enter client name">
                </div>
            </div>
            <div class="modal-box-ft">
                <button id="btnCancelClient" class="btn-outline">Cancel</button>
                <button id="btnSaveClient" class="btn-primary">
                    <i data-lucide="user-plus"></i> Add Client
                </button>
            </div>
        </div>
    </div>

    <!-- ── Reset Confirm Modal ── -->
    <div id="resetConfirmModal" class="confirm-overlay">
        <div class="confirm-box">
            <div class="confirm-inner">
                <div class="confirm-icon-wrap"><i data-lucide="alert-triangle"></i></div>
                <h3>Reset All Entries?</h3>
                <p>This will permanently delete <strong>all inventory records</strong>.<br>This action cannot be undone.
                </p>
            </div>
            <div class="confirm-footer">
                <button id="btnCancelReset" class="btn-outline">Cancel</button>
                <button id="btnConfirmReset" class="btn-danger-solid">
                    <i data-lucide="trash-2"></i> Reset
                </button>
            </div>
        </div>
    </div>

    <script src="script.js"></script>

    <script>
        /* ═══════════════════════════════════════
           PAGE INIT & INTERACTIVE LAYER
           ═══════════════════════════════════════ */

        /* ── Init Lucide icons ── */
        lucide.createIcons();

        /* ── Topbar live date ── */
        (function updateDate() {
            document.getElementById('topbarDate').textContent =
                new Date().toLocaleDateString('en-IN', {
                    weekday: 'short', day: 'numeric', month: 'short', year: 'numeric'
                });
            setTimeout(updateDate, 30000);
        })();

        /* ── Toast System ── */
        function showToast(message, type = 'success') {
            const icons = { success: 'check-circle', error: 'x-circle', info: 'info' };
            const stack = document.getElementById('toastStack');
            const el = document.createElement('div');
            el.className = `toast ${type}`;
            el.innerHTML = `
        <span class="toast-icon"><i data-lucide="${icons[type] || 'info'}"></i></span>
        <span>${message}</span>`;
            stack.appendChild(el);
            lucide.createIcons({ nodes: [el] });

            setTimeout(() => {
                el.classList.add('toast-out');
                setTimeout(() => el.remove(), 280);
            }, 3200);
        }

        /* ── Mobile Sidebar ── */
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('sbOverlay');
        const menuBtn = document.getElementById('mobileMenuBtn');

        function openSidebar() { sidebar.classList.add('sb-open'); overlay.classList.add('active'); document.body.style.overflow = 'hidden'; }
        function closeSidebar() { sidebar.classList.remove('sb-open'); overlay.classList.remove('active'); document.body.style.overflow = ''; }

        menuBtn.addEventListener('click', () =>
            sidebar.classList.contains('sb-open') ? closeSidebar() : openSidebar()
        );
        overlay.addEventListener('click', closeSidebar);

        /* Close sidebar when a nav link is tapped on mobile */
        sidebar.querySelectorAll('nav a').forEach(a =>
            a.addEventListener('click', () => { if (window.innerWidth <= 768) closeSidebar(); })
        );

        /* ── Form Validation ── */
        const validatableFields = [
            { id: 'name', grp: 'grp-name' },
            { id: 'date', grp: 'grp-date' },
            { id: 'material', grp: 'grp-material' },
            { id: 'quantity', grp: 'grp-quantity' },
            { id: 'price', grp: 'grp-price' },
        ];

        validatableFields.forEach(({ id, grp }) => {
            const input = document.getElementById(id);
            const group = document.getElementById(grp);
            if (!input || !group) return;

            input.addEventListener('blur', () => {
                if (!input.value.trim() || input.value === '') {
                    group.classList.add('has-error');
                } else {
                    group.classList.remove('has-error');
                }
            });
            input.addEventListener('input', () => {
                if (input.value.trim()) group.classList.remove('has-error');
            });
        });

        function validateForm() {
            let valid = true;
            validatableFields.forEach(({ id, grp }) => {
                const input = document.getElementById(id);
                const group = document.getElementById(grp);
                if (!input || !group) return;
                if (!input.value.trim()) {
                    group.classList.add('has-error');
                    valid = false;
                } else {
                    group.classList.remove('has-error');
                }
            });
            return valid;
        }


        /* ── Clear Form ── */
        document.getElementById('btnClearForm').addEventListener('click', () => {
            invForm.reset();
            document.getElementById('date').valueAsDate = new Date();
            document.getElementById('total').value = '';
            /* Remove any validation highlights */
            invForm.querySelectorAll('.has-error').forEach(g => g.classList.remove('has-error'));
            showToast('Form cleared.', 'info');
        });

        /* ── Stats Updater with pop animation ── */
        function animateStat(el, newVal) {
            if (el.textContent !== newVal) {
                el.textContent = newVal;
                el.classList.remove('updated');
                void el.offsetWidth; /* reflow trick */
                el.classList.add('updated');
            }
        }

        function updateStats() {
            const entries = typeof getEntries === 'function' ? getEntries() : [];
            const today = new Date().toISOString().split('T')[0];
            const month = today.slice(0, 7);
            const fmt = n => n >= 100000
                ? '₹' + (n / 100000).toFixed(1) + 'L'
                : n >= 1000 ? '₹' + (n / 1000).toFixed(1) + 'K'
                    : '₹' + n.toFixed(0);

            const todayAmt = entries.filter(e => e.date === today).reduce((s, e) => s + (e.price || 0), 0);
            const monthAmt = entries.filter(e => (e.date || '').startsWith(month)).reduce((s, e) => s + (e.price || 0), 0);

            animateStat(document.getElementById('statTotal'), String(entries.length));
            animateStat(document.getElementById('statToday'), fmt(todayAmt));
            animateStat(document.getElementById('statMonth'), fmt(monthAmt));
        }

        setTimeout(updateStats, 100);

        /* ── Data table badge count updater ── */
        document.getElementById('btnViewData').addEventListener('click', () => {
            setTimeout(() => {
                const all = typeof getEntries === 'function' ? getEntries() : [];
                const badge = document.getElementById('entriesCountBadge');
                if (badge) badge.textContent = all.length > 100
                    ? `Showing 100 of ${all.length}`
                    : `${all.length} record${all.length !== 1 ? 's' : ''}`;
            }, 80);
        });

        /* ── Report close also shows toast ── */
        document.getElementById('closeReport').addEventListener('click', () => {
            document.getElementById('reportsSection').classList.add('hidden');
        });
        document.getElementById('closeData').addEventListener('click', () => {
            document.getElementById('dataSection').classList.add('hidden');
        });

        /* ── Keyboard: ESC closes modals / sidebar ── */
        document.addEventListener('keydown', e => {
            if (e.key === 'Escape') {
                closeSidebar();
                document.getElementById('newClientModal').classList.add('hidden');
                document.getElementById('resetConfirmModal').classList.remove('active');
            }
        });
    </script>
</body>

</html>